!function(e){"use strict";function n(){}function t(){return f}var r,o=function(e){function n(){return t}var t=e;return{get:n,set:function(e){t=e},clone:function(){return o(n())}}},i=tinymce.util.Tools.resolve("tinymce.PluginManager"),u=tinymce.util.Tools.resolve("tinymce.util.Tools"),a=function(e){return function(){return e}},c=a(!1),s=a(!0),f=(r={fold:function(e,n){return e()},is:c,isSome:c,isNone:s,getOr:m,getOrThunk:d,getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:a(null),getOrUndefined:a(void 0),or:m,orThunk:d,map:t,each:n,bind:t,exists:c,forall:s,filter:t,equals:l,equals_:l,toArray:function(){return[]},toString:a("none()")},Object.freeze&&Object.freeze(r),r);function l(e){return e.isNone()}function d(e){return e()}function m(e){return e}var h=function(e){function n(){return o}function t(n){return n(e)}var r=a(e),o={fold:function(n,t){return t(e)},is:function(n){return e===n},isSome:s,isNone:c,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:n,orThunk:n,map:function(n){return h(n(e))},each:function(n){n(e)},bind:t,exists:t,forall:t,filter:function(n){return n(e)?o:f},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(n){return n.is(e)},equals_:function(n,t){return n.fold(c,(function(n){return t(e,n)}))}};return o},g={some:h,none:t,from:function(e){return null===e||void 0===e?f:h(e)}};function v(n,t){return y(e.document.createElement("canvas"),n,t)}function p(e){var n=v(e.width,e.height);return w(n).drawImage(e,0,0),n}function w(e){return e.getContext("2d")}function y(e,n,t){return e.width=n,e.height=t,e}var b,O,E=window.Promise?window.Promise:(b=S.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(n){e.setTimeout(n,1)},O=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},S.prototype["catch"]=function(e){return this.then(null,e)},S.prototype.then=function(e,n){var t=this;return new S((function(r,o){I.call(t,new R(e,n,r,o))}))},S.all=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t=Array.prototype.slice.call(1===e.length&&O(e[0])?e[0]:e);return new S((function(e,n){if(0===t.length)return e([]);var r=t.length;function i(u,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void c.call(a,(function(e){i(u,e)}),n)}t[u]=a,0==--r&&e(t)}catch(o){n(o)}}for(var u=0;u<t.length;u++)i(u,t[u])}))},S.resolve=function(e){return e&&"object"==typeof e&&e.constructor===S?e:new S((function(n){n(e)}))},S.reject=function(e){return new S((function(n,t){t(e)}))},S.race=function(e){return new S((function(n,t){for(var r=0,o=e;r<o.length;r++)o[r].then(n,t)}))},S);function S(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],A(e,T(x,this),T(N,this))}function T(e,n){return function(){return e.apply(n,arguments)}}function I(e){var n=this;null!==this._state?b((function(){var t=n._state?e.onFulfilled:e.onRejected;if(null!==t){var o;try{o=t(n._value)}catch(r){return void e.reject(r)}e.resolve(o)}else(n._state?e.resolve:e.reject)(n._value)})):this._deferreds.push(e)}function x(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void A(T(n,e),T(x,this),T(N,this))}this._state=!0,this._value=e,_.call(this)}catch(r){N.call(this,r)}}function N(e){this._state=!1,this._value=e,_.call(this)}function _(){for(var e=0,n=this._deferreds;e<n.length;e++){var t=n[e];I.call(this,t)}this._deferreds=[]}function R(e,n,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.resolve=t,this.reject=r}function A(e,n,t){var r=!1;try{e((function(e){r||(r=!0,n(e))}),(function(e){r||(r=!0,t(e))}))}catch(i){if(r)return;r=!0,t(i)}}function C(n){var t=n.src;return 0===t.indexOf("data:")?D(t):function(n){return new E((function(t,r){var o=new e.XMLHttpRequest;o.open("GET",n,!0),o.responseType="blob",o.onload=function(){200===this.status&&t(this.response)},o.onerror=function(){var e,n=this;r(0===this.status?((e=new Error("No access to download image")).code=18,e.name="SecurityError",e):new Error("Error "+n.status+" downloading image"))},o.send()}))}(t)}function U(n){return new E((function(t,r){var o=e.URL.createObjectURL(n),i=new e.Image,u=function(){i.removeEventListener("load",a),i.removeEventListener("error",c)};function a(){u(),t(i)}function c(){u(),r("Unable to load data of type "+n.type+": "+o)}i.addEventListener("load",a),i.addEventListener("error",c),i.src=o,i.complete&&a()}))}function D(n){return new E((function(t,r){(function(n){var t=n.split(","),r=/data:([^;]+)/.exec(t[0]);if(!r)return g.none();for(var o=r[1],i=t[1],u=e.atob(i),a=u.length,c=Math.ceil(a/1024),s=new Array(c),f=0;f<c;++f){for(var l=1024*f,d=Math.min(1024+l,a),m=new Array(d-l),h=l,v=0;h<d;++v,++h)m[v]=u[h].charCodeAt(0);s[f]=new Uint8Array(m)}return g.some(new e.Blob(s,{type:o}))})(n).fold((function(){r("uri is not base64: "+n)}),t)}))}function L(n,t,r){return t=t||"image/png",e.HTMLCanvasElement.prototype.toBlob?new E((function(e,o){n.toBlob((function(n){n?e(n):o()}),t,r)})):D(n.toDataURL(t,r))}function k(n){return U(n).then((function(n){!function(n){e.URL.revokeObjectURL(n.src)}(n);var t=v(function(e){return e.naturalWidth||e.width}(n),function(e){return e.naturalHeight||e.height}(n));return w(t).drawImage(n,0,0),t}))}function j(e,n,t){var r=n.type;function o(n,t){return e.then((function(e){return function(e,n,t){return n=n||"image/png",e.toDataURL(n,t)}(e,n,t)}))}return{getType:a(r),toBlob:function(){return E.resolve(n)},toDataURL:function(){return t},toBase64:function(){return t.split(",")[1]},toAdjustedBlob:function(n,t){return e.then((function(e){return L(e,n,t)}))},toAdjustedDataURL:o,toAdjustedBase64:function(e,n){return o(e,n).then((function(e){return e.split(",")[1]}))},toCanvas:function(){return e.then(p)}}}function P(n){return function(n){return new E((function(t){var r=new e.FileReader;r.onloadend=function(){t(r.result)},r.readAsDataURL(n)}))}(n).then((function(e){return j(k(n),n,e)}))}function M(e,n){return L(e,n).then((function(n){return j(E.resolve(e),n,e.toDataURL())}))}function B(e,n){return e.toCanvas().then((function(t){return function(e,n,t){var r=v(e.width,e.height),o=w(r),i=0,u=0;return 90!==(t=t<0?360+t:t)&&270!==t||y(r,r.height,r.width),90!==t&&180!==t||(i=r.width),270!==t&&180!==t||(u=r.height),o.translate(i,u),o.rotate(t*Math.PI/180),o.drawImage(e,0,0),M(r,n)}(t,e.getType(),n)}))}function F(e,n){return e.toCanvas().then((function(t){return function(e,n,t){var r=v(e.width,e.height),o=w(r);return"v"===t?(o.scale(1,-1),o.drawImage(e,0,-r.height)):(o.scale(-1,1),o.drawImage(e,-r.width,0)),M(r,n)}(t,e.getType(),n)}))}function z(e){return P(e)}var H=tinymce.util.Tools.resolve("tinymce.util.Delay"),q=tinymce.util.Tools.resolve("tinymce.util.Promise"),$=tinymce.util.Tools.resolve("tinymce.util.URI");function X(e,n){for(var t=0,r=e.length;t<r;t++){var o=e[t];if(n(o,t))return g.some(o)}return g.none()}function W(e){return null!==e&&void 0!==e}function G(e){return"ImageProxy HTTP error: "+X(ie,(function(n){return e===n.code})).fold(a("Unknown ImageProxy error"),(function(e){return e.message}))}function V(e){var n=G(e);return q.reject(n)}function Y(e){return X(ue,(function(n){return n.type===e})).fold(a("Unknown service error"),(function(e){return e.message}))}function J(e,n){return te(n).then((function(e){var n=function(e){var n=oe(e),t=ne(n,["error","type"]);return"ImageProxy Service error: "+(t?Y(t):"Invalid JSON in service error message")}(e);return q.reject(n)}))}function K(e,n){var t={"Content-Type":"application/json;charset=UTF-8","tiny-api-key":n};return re(function(e,n){var t=-1===e.indexOf("?")?"?":"&";return/[?&]apiKey=/.test(e)||!n?e:e+t+"apiKey="+encodeURIComponent(n)}(e,n),t,!1).then((function(e){return e.status<200||300<=e.status?ae(e.status,e.blob):q.resolve(e.blob)}))}var Q,Z={getImageSize:function(e){var n,t;function r(e){return/^[0-9\.]+px$/.test(e)}return n=e.style.width,t=e.style.height,n||t?r(n)&&r(t)?{w:parseInt(n,10),h:parseInt(t,10)}:null:(n=e.width,t=e.height,n&&t?{w:parseInt(n,10),h:parseInt(t,10)}:null)},setImageSize:function(e,n){var t,r;n&&(t=e.style.width,r=e.style.height,(t||r)&&(e.style.width=n.w+"px",e.style.height=n.h+"px",e.removeAttribute("data-mce-style")),t=e.width,r=e.height,(t||r)&&(e.setAttribute("width",n.w),e.setAttribute("height",n.h)))},getNaturalImageSize:function(e){return{w:e.naturalWidth,h:e.naturalHeight}}},ee=(Q="function",function(e){return function(e){if(null===e)return"null";var n=typeof e;return"object"==n&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==n&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":n}(e)===Q}),ne=(Array.prototype.slice,ee(Array.from)&&Array.from,function(e,n){var t;return t=n.reduce((function(e,n){return W(e)?e[n]:void 0}),e),W(t)?t:null}),te=function(n){return new q((function(t){var r=new e.FileReader;r.onload=function(e){var n=e.target;t(n.result)},r.readAsText(n)}))},re=function(n,t,r){return new q((function(o){var i;(i=new e.XMLHttpRequest).onreadystatechange=function(){4===i.readyState&&o({status:i.status,blob:this.response})},i.open("GET",n,!0),i.withCredentials=r,u.each(t,(function(e,n){i.setRequestHeader(n,e)})),i.responseType="blob",i.send()}))},oe=function(e){var n;try{n=JSON.parse(e)}catch(r){}return n},ie=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],ue=[{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],ae=function(e,n){return function(e){return 400===e||403===e||500===e}(e)?J(0,n):V(e)},ce=V;function se(e,n,t){return n?K(e,n):function(e,n){return re(e,{},n).then((function(e){return e.status<200||300<=e.status?ce(e.status):q.resolve(e.blob)}))}(e,t)}function fe(e,n){var t=function(e,n){for(var t=0;t<e.length;t++){var r=e[t];if(r.test(n))return r}}(e,n);if(!t)return{major:0,minor:0};function r(e){return Number(n.replace(t,"$"+e))}return _e(r(1),r(2))}function le(e,n){return function(){return n===e}}function de(e,n){return function(){return n===e}}function me(e,n){var t=String(n).toLowerCase();return X(e,(function(e){return e.search(t)}))}function he(e,n){return-1!==e.indexOf(n)}function ge(e){return function(n){return he(n,e)}}function ve(e,n){return function(e,n){return X(e.dom().childNodes,(function(e){return n(Ve.fromDom(e))})).map(Ve.fromDom)}(e,(function(e){return function(e,n){var t=e.dom();if(t.nodeType!==Je)return!1;var r=t;if(void 0!==r.matches)return r.matches(n);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(n);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(n);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(n);throw new Error("Browser lacks native selectors")}(e,n)}))}function pe(e){return ve(Ve.fromDom(e),"img")}function we(e,n){return e.dom.is(n,"figure")}function ye(e,n){e.notificationManager.open({text:n,type:"error"})}function be(e){var n=e.selection.getNode();return we(e,n)?pe(n):g.some(Ve.fromDom(n))}function Oe(e,n){var t,r=n.src;return Ze(e,n)?se(n.src,null,function(e,n){return-1!==u.inArray(function(e){return e.getParam("imagetools_credentials_hosts",[],"string[]")}(e),new $(n.src).host)}(e,n)):Qe(e,n)?function(e){return C(e)}(n):(r=function(e){return e.getParam("imagetools_proxy")}(e),r+=(-1===r.indexOf("?")?"?":"&")+"url="+encodeURIComponent(n.src),t=function(e){return e.getParam("api_key",e.getParam("imagetools_api_key","","string"),"string")}(e),se(r,t,!1))}function Ee(e,n){return function(e){return g.from(e.getParam("imagetools_fetch_image",null,"function"))}(e).fold((function(){return Oe(e,n)}),(function(e){return e(n)}))}function Se(e,n){var t;return(t=e.editorUpload.blobCache.getByUri(n.src))?q.resolve(t.blob()):Ee(e,n)}function Te(e){H.clearTimeout(e.get())}function Ie(e,n,t,r,o,i){return n.toBlob().then((function(u){var a,c,s,f;return s=e.editorUpload.blobCache,a=o.src,function(e){return e.getParam("images_reuse_filename",!1,"boolean")}(e)&&(c=(f=s.getByUri(a))?(a=f.uri(),f.name()):function(e,n){var t=n.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);return t?e.dom.encode(t[1]):null}(e,a)),f=s.create({id:"imagetools"+Ke++,blob:u,base64:n.toBase64(),uri:a,name:c}),s.add(f),e.undoManager.transact((function(){e.$(o).on("load",(function n(){e.$(o).off("load",n),e.nodeChanged(),t?e.editorUpload.uploadImagesAuto():(Te(r),function(e,n){var t=H.setEditorTimeout(e,(function(){e.editorUpload.uploadImagesAuto()}),function(e){return e.getParam("images_upload_timeout",3e4,"number")}(e));n.set(t)}(e,r))})),i&&e.$(o).attr({width:i.w,height:i.h}),e.$(o).attr({src:f.blobUri()}).removeAttr("data-mce-src")})),f}))}function xe(e,n,t,r){return function(){return be(e).fold((function(){ye(e,"Could not find selected image")}),(function(o){return e._scanForImages().then((function(){return Se(e,o.dom())})).then(z).then(t).then((function(t){return Ie(e,t,!1,n,o.dom(),r)}),(function(n){ye(e,n)}))}))}}var Ne=function(){return _e(0,0)},_e=function(e,n){return{major:e,minor:n}},Re={nu:_e,detect:function(e,n){var t=String(n).toLowerCase();return 0===e.length?Ne():fe(e,t)},unknown:Ne},Ae="Firefox",Ce=function(e){var n=e.current;return{current:n,version:e.version,isEdge:le("Edge",n),isChrome:le("Chrome",n),isIE:le("IE",n),isOpera:le("Opera",n),isFirefox:le(Ae,n),isSafari:le("Safari",n)}},Ue={unknown:function(){return Ce({current:void 0,version:Re.unknown()})},nu:Ce,edge:a("Edge"),chrome:a("Chrome"),ie:a("IE"),opera:a("Opera"),firefox:a(Ae),safari:a("Safari")},De="Windows",Le="Android",ke="Solaris",je="FreeBSD",Pe="ChromeOS",Me=function(e){var n=e.current;return{current:n,version:e.version,isWindows:de(De,n),isiOS:de("iOS",n),isAndroid:de(Le,n),isOSX:de("OSX",n),isLinux:de("Linux",n),isSolaris:de(ke,n),isFreeBSD:de(je,n),isChromeOS:de(Pe,n)}},Be={unknown:function(){return Me({current:void 0,version:Re.unknown()})},nu:Me,windows:a(De),ios:a("iOS"),android:a(Le),linux:a("Linux"),osx:a("OSX"),solaris:a(ke),freebsd:a(je),chromeos:a(Pe)},Fe=function(e,n){return me(e,n).map((function(e){var t=Re.detect(e.versionRegexes,n);return{current:e.name,version:t}}))},ze=function(e,n){return me(e,n).map((function(e){var t=Re.detect(e.versionRegexes,n);return{current:e.name,version:t}}))},He=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,qe=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return he(e,"edge/")&&he(e,"chrome")&&he(e,"safari")&&he(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,He],search:function(e){return he(e,"chrome")&&!he(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return he(e,"msie")||he(e,"trident")}},{name:"Opera",versionRegexes:[He,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:ge("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:ge("firefox")},{name:"Safari",versionRegexes:[He,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(he(e,"safari")||he(e,"mobile/"))&&he(e,"applewebkit")}}],$e=[{name:"Windows",search:ge("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return he(e,"iphone")||he(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:ge("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:ge("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:ge("linux"),versionRegexes:[]},{name:"Solaris",search:ge("sunos"),versionRegexes:[]},{name:"FreeBSD",search:ge("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:ge("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],Xe={browsers:a(qe),oses:a($e)},We=o(function(e,n){var t=Xe.browsers(),r=Xe.oses(),o=Fe(t,e).fold(Ue.unknown,Ue.nu),i=ze(r,e).fold(Be.unknown,Be.nu);return{browser:o,os:i,deviceType:function(e,n,t,r){var o=e.isiOS()&&!0===/ipad/i.test(t),i=e.isiOS()&&!o,u=e.isiOS()||e.isAndroid(),c=u||r("(pointer:coarse)"),s=o||!i&&u&&r("(min-device-width:768px)"),f=i||u&&!s,l=n.isSafari()&&e.isiOS()&&!1===/safari/i.test(t),d=!f&&!s&&!l;return{isiPad:a(o),isiPhone:a(i),isTablet:a(s),isPhone:a(f),isTouch:a(c),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:a(l),isDesktop:a(d)}}(i,o,e,n)}}(e.navigator.userAgent,(function(n){return e.window.matchMedia(n).matches}))),Ge=function(e){if(null===e||void 0===e)throw new Error("Node cannot be null or undefined");return{dom:a(e)}},Ve={fromHtml:function(n,t){var r=(t||e.document).createElement("div");if(r.innerHTML=n,!r.hasChildNodes()||1<r.childNodes.length)throw e.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return Ge(r.childNodes[0])},fromTag:function(n,t){var r=(t||e.document).createElement(n);return Ge(r)},fromText:function(n,t){var r=(t||e.document).createTextNode(n);return Ge(r)},fromDom:Ge,fromPoint:function(e,n,t){var r=e.dom();return g.from(r.elementFromPoint(n,t)).map(Ge)}},Ye=(e.Node.ATTRIBUTE_NODE,e.Node.CDATA_SECTION_NODE,e.Node.COMMENT_NODE,e.Node.DOCUMENT_NODE,e.Node.DOCUMENT_TYPE_NODE,e.Node.DOCUMENT_FRAGMENT_NODE,e.Node.ELEMENT_NODE),Je=(e.Node.TEXT_NODE,e.Node.PROCESSING_INSTRUCTION_NODE,e.Node.ENTITY_REFERENCE_NODE,e.Node.ENTITY_NODE,e.Node.NOTATION_NODE,Ye),Ke=(We.get().browser.isIE(),"undefined"!=typeof e.window?e.window:Function("return this;")(),0),Qe=function(e,n){var t=n.src;return 0===t.indexOf("data:")||0===t.indexOf("blob:")||new $(t).host===e.documentBaseURI.host},Ze=function(e,n){return-1!==u.inArray(function(e){return e.getParam("imagetools_cors_hosts",[],"string[]")}(e),new $(n.src).host)},en=function(e,n,t){return function(){var r=be(e).fold((function(){return null}),(function(e){var n=Z.getImageSize(e.dom());return n?{w:n.h,h:n.w}:null}));return xe(e,n,(function(e){return function(e,n){return B(e,n)}(e,t)}),r)()}},nn=function(e,n,t){return function(){return xe(e,n,(function(e){return function(e,n){return F(e,n)}(e,t)}))()}},tn=function(e,n){function t(n){return function(n){return e.dom.is(n,"img:not([data-mce-object],[data-mce-placeholder])")}(n)&&(Qe(e,n)||Ze(e,n)||e.settings.imagetools_proxy)}return we(e,n)?pe(n).map((function(e){return t(e.dom())?g.some(e.dom()):g.none()})):t(n)?g.some(n):g.none()},rn=Te,on=Se,un=be,an=function(n,t,r,o,i){return new q((function(u){(function(e){return U(e)})(i).then((function(n){var t=Z.getNaturalImageSize(n);return o.w===t.w&&o.h===t.h||Z.getImageSize(r)&&Z.setImageSize(r,t),e.URL.revokeObjectURL(n.src),i})).then(z).then((function(e){return Ie(n,e,!0,t,r)}),(function(){}))}))},cn=a("save-state"),sn=a("disable"),fn=a("enable"),ln=function(n,t){return function(){var r=un(n),o=r.map((function(e){return Z.getNaturalImageSize(e.dom())}));un(n).each((function(i){tn(n,i.dom()).each((function(u){on(n,i.dom()).then((function(i){var u=function(n){return{blob:n,url:e.URL.createObjectURL(n)}}(i);n.windowManager.open(function(e){return{title:"Edit Image",size:"large",body:{type:"panel",items:[{type:"imagetools",name:"imagetools",label:"Edit Image",currentState:e}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0,disabled:!0}],onSubmit:function(e){var i=e.getData().imagetools.blob;r.each((function(e){o.each((function(r){an(n,t,e.dom(),r,i)}))})),e.close()},onCancel:function(){},onAction:function(e,n){switch(n.name){case cn():n.value?e.enable("save"):e.disable("save");break;case sn():e.disable("save"),e.disable("cancel");break;case fn():e.enable("cancel")}}}}(u))}))}))}))}},dn=function(e,n){u.each({mceImageRotateLeft:en(e,n,-90),mceImageRotateRight:en(e,n,90),mceImageFlipVertical:nn(e,n,"v"),mceImageFlipHorizontal:nn(e,n,"h"),mceEditImage:ln(e,n)},(function(n,t){e.addCommand(t,n)}))},mn=function(e,n,t){e.on("NodeChange",(function(r){var o=t.get();o&&o.src!==r.element.src&&(rn(n),e.editorUpload.uploadImagesAuto(),t.set(null)),tn(e,r.element).each(t.set)}))},hn=function(e){function n(n){return function(){return e.execCommand(n)}}e.ui.registry.addButton("rotateleft",{tooltip:"Rotate counterclockwise",icon:"rotate-left",onAction:n("mceImageRotateLeft")}),e.ui.registry.addButton("rotateright",{tooltip:"Rotate clockwise",icon:"rotate-right",onAction:n("mceImageRotateRight")}),e.ui.registry.addButton("flipv",{tooltip:"Flip vertically",icon:"flip-vertically",onAction:n("mceImageFlipVertical")}),e.ui.registry.addButton("fliph",{tooltip:"Flip horizontally",icon:"flip-horizontally",onAction:n("mceImageFlipHorizontal")}),e.ui.registry.addButton("editimage",{tooltip:"Edit image",icon:"edit-image",onAction:n("mceEditImage"),onSetup:function(n){function t(){un(e).each((function(t){var r=tn(e,t.dom()).isNone();n.setDisabled(r)}))}return e.on("NodeChange",t),function(){e.off("NodeChange",t)}}}),e.ui.registry.addButton("imageoptions",{tooltip:"Image options",icon:"image-options",onAction:n("mceImage")}),e.ui.registry.addContextMenu("imagetools",{update:function(t){return tn(e,t).fold((function(){return[]}),(function(e){return[{text:"Edit image",icon:"edit-image",onAction:n("mceEditImage")}]}))}})},gn=function(e){e.ui.registry.addContextToolbar("imagetools",{items:function(e){return e.getParam("imagetools_toolbar","rotateleft rotateright flipv fliph editimage imageoptions")}(e),predicate:function(n){return tn(e,n).isSome()},position:"node",scope:"node"})};!function(){i.add("imagetools",(function(e){var n=o(0),t=o(null);dn(e,n),hn(e),gn(e),mn(e,n,t)}))}()}(window);