!function(n){"use strict";function t(){}function e(n){return function(){return n}}function r(){return a}var o,i=tinymce.util.Tools.resolve("tinymce.PluginManager"),u=e(!1),c=e(!0),a=(o={fold:function(n,t){return n()},is:u,isSome:u,isNone:c,getOr:f,getOrThunk:s,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:e(null),getOrUndefined:e(void 0),or:f,orThunk:s,map:r,each:t,bind:r,exists:u,forall:c,filter:r,equals:l,equals_:l,toArray:function(){return[]},toString:e("none()")},Object.freeze&&Object.freeze(o),o);function l(n){return n.isNone()}function s(n){return n()}function f(n){return n}function m(n,t){return-1!==n.indexOf(t)}function g(n,t){return m(n.title.toLowerCase(),t)||function(n,t){for(var e=0,r=n.length;e<r;e++)if(t(n[e],e))return!0;return!1}(n.keywords,(function(n){return m(n.toLowerCase(),t)}))}function d(n,t,e){for(var r=[],o=t.toLowerCase(),i=e.fold((function(){return u}),(function(n){return function(t){return n<=t}})),c=0;c<n.length&&(0!==t.length&&!g(n[c],o)||(r.push({value:n[c]["char"],text:n[c].title,icon:n[c]["char"]}),!i(r.length)));c++);return r}function y(n,t){for(var e=P(n),r=0,o=e.length;r<o;r++){var i=e[r];t(n[i],i)}}function p(n,t){return function(n,t){return D.call(n,t)}(n,t)?n[t]:t}function v(n){return function(n,t){return S(n,(function(n,e){return{k:e,v:t(n,e)}}))}(q(n),(function(n){return k({keywords:[],category:"user"},n)}))}function h(t,e,r){var o=C(A.none()),i=C(A.none());t.on("init",(function(){x.load(r,e).then((function(n){var e=v(t);!function(n){var t={},e=[];y(n,(function(n,r){var o={title:r,keywords:n.keywords,char:n["char"],category:p(I,n.category)},i=void 0!==t[o.category]?t[o.category]:[];t[o.category]=i.concat([o]),e.push(o)})),o.set(A.some(t)),i.set(A.some(e))}(_(n,e))}),(function(t){n.console.log("Failed to load emoticons: "+t),o.set(A.some({})),i.set(A.some([]))}))}));var u=function(){return i.get().getOr([])},c=function(){return o.get().isSome()&&i.get().isSome()};return{listCategories:function(){return[z].concat(P(o.get().getOr({})))},hasLoaded:c,waitForLoad:function(){return c()?N.resolve(!0):new N((function(t,r){var o=15,i=L.setInterval((function(){c()?(L.clearInterval(i),t(!0)):--o<0&&(n.console.log("Could not load emojis from url: "+e),L.clearInterval(i),r(!1))}),100)}))},listAll:u,listCategory:function(n){return n===z?u():o.get().bind((function(t){return A.from(t[n])})).getOr([])}}}var b,O,w=function(n){function t(){return i}function r(t){return t(n)}var o=e(n),i={fold:function(t,e){return e(n)},is:function(t){return n===t},isSome:c,isNone:u,getOr:o,getOrThunk:o,getOrDie:o,getOrNull:o,getOrUndefined:o,or:t,orThunk:t,map:function(t){return w(t(n))},each:function(t){t(n)},bind:r,exists:r,forall:r,filter:function(t){return t(n)?i:a},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(t){return t.is(n)},equals_:function(t,e){return t.fold(u,(function(t){return e(n,t)}))}};return i},A={some:w,none:r,from:function(n){return null===n||void 0===n?a:w(n)}},j=(b="function",function(n){return function(n){if(null===n)return"null";var t=typeof n;return"object"==t&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":t}(n)===b}),C=(Array.prototype.slice,j(Array.from)&&Array.from,function(n){function t(){return e}var e=n;return{get:t,set:function(n){e=n},clone:function(){return C(t())}}}),k=function(){return(k=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)},T=Object.prototype.hasOwnProperty,_=(O=function(n,t){return t},function(){for(var n=new Array(arguments.length),t=0;t<n.length;t++)n[t]=arguments[t];if(0===n.length)throw new Error("Can't merge zero objects");for(var e={},r=0;r<n.length;r++){var o=n[r];for(var i in o)T.call(o,i)&&(e[i]=O(e[i],o[i]))}return e}),P=Object.keys,D=Object.hasOwnProperty,S=function(n,t){var e={};return y(n,(function(n,r){var o=t(n,r);e[o.k]=o.v})),e},x=tinymce.util.Tools.resolve("tinymce.Resource"),L=tinymce.util.Tools.resolve("tinymce.util.Delay"),N=tinymce.util.Tools.resolve("tinymce.util.Promise"),E=function(n,t){return n.getParam("emoticons_database_url",t+"/js/emojis"+n.suffix+".js")},F=function(n){return n.getParam("emoticons_database_id","tinymce.plugins.emoticons","string")},q=function(n){return n.getParam("emoticons_append",{},"object")},z="All",I={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},M="pattern",U=function(t,e){function r(){return{title:"Emoticons",size:"normal",body:{type:"tabpanel",tabs:function(n,t){for(var e=n.length,r=new Array(e),o=0;o<e;o++){var i=n[o];r[o]=t(i,o)}return r}(e.listCategories(),(function(n){return{title:n,name:n,items:[c,a]}}))},initialData:o,onTabChange:function(n,t){i.set(t.newTabName),u.throttle(n)},onChange:u.throttle,onAction:function(n,e){"results"===e.name&&(function(n,t){n.insertContent(t)}(t,e.value),n.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}}var o={pattern:"",results:d(e.listAll(),"",A.some(300))},i=C(z),u=function(t,e){var r=null;return{cancel:function(){null!==r&&(n.clearTimeout(r),r=null)},throttle:function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];null!==r&&n.clearTimeout(r),r=n.setTimeout((function(){t.apply(null,o),r=null}),e)}}}((function(n){!function(n){var t=n.getData(),r=i.get(),o=e.listCategory(r),u=d(o,t[M],r===z?A.some(300):A.none());n.setData({results:u})}(n)}),200),c={label:"Search",type:"input",name:M},a={type:"collection",name:"results"},l=t.windowManager.open(r());l.focus(M),e.hasLoaded()||(l.block("Loading emoticons..."),e.waitForLoad().then((function(){l.redial(r()),u.throttle(l),l.focus(M),l.unblock()}))["catch"]((function(n){l.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),l.focus(M),l.unblock()})))},R=function(n,t){function e(){return U(n,t)}n.ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:e}),n.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:e})};!function(){i.add("emoticons",(function(n,t){var e=E(n,t),r=F(n),o=h(n,e,r);R(n,o),function(n,t){n.ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(n,e){return t.waitForLoad().then((function(){var r=t.listAll();return d(r,n,A.some(e))}))},onAction:function(t,e,r){n.selection.setRng(e),n.insertContent(r),t.hide()}})}(n,o)}))}()}(window);