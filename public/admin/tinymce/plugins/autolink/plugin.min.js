!function(){"use strict";function t(t,e){if(e<0&&(e=0),3===t.nodeType){var n=t.data.length;n<e&&(e=n)}return e}function e(e,n,i){1!==n.nodeType||n.hasChildNodes()?e.setStart(n,t(n,i)):e.setStartBefore(n)}function n(e,n,i){1!==n.nodeType||n.hasChildNodes()?e.setEnd(n,t(n,i)):e.setEndAfter(n)}var i=tinymce.util.Tools.resolve("tinymce.PluginManager"),o=tinymce.util.Tools.resolve("tinymce.Env"),r=function(t){return t.getParam("autolink_pattern",/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i)},f=function(t){return t.getParam("default_link_target",!1)},a=function(t){return t.getParam("link_default_protocol","http","string")},s=function(t,i,o){var s,d,l,c,u,g,h,m,C,y,k=r(t),p=f(t);if("A"!==t.selection.getNode().tagName){if((s=t.selection.getRng(!0).cloneRange()).startOffset<5){if(!(m=s.endContainer.previousSibling)){if(!s.endContainer.firstChild||!s.endContainer.firstChild.nextSibling)return;m=s.endContainer.firstChild.nextSibling}if(C=m.length,e(s,m,C),n(s,m,C),s.endOffset<5)return;d=s.endOffset,c=m}else{if(3!==(c=s.endContainer).nodeType&&c.firstChild){for(;3!==c.nodeType&&c.firstChild;)c=c.firstChild;3===c.nodeType&&(e(s,c,0),n(s,c,c.nodeValue.length))}d=1===s.endOffset?2:s.endOffset-1-i}for(l=d;e(s,c,2<=d?d-2:0),n(s,c,1<=d?d-1:0),d-=1," "!==(y=s.toString())&&""!==y&&160!==y.charCodeAt(0)&&0<=d-2&&y!==o;);!function(t,e){return t===e||" "===t||160===t.charCodeAt(0)}(s.toString(),o)?(0===s.startOffset?e(s,c,0):e(s,c,d),n(s,c,l)):(e(s,c,d),n(s,c,l),d+=1),"."===(g=s.toString()).charAt(g.length-1)&&n(s,c,l-1),h=(g=s.toString().trim()).match(k);var w=a(t);h&&("www."===h[1]?h[1]=w+"://www.":/@$/.test(h[1])&&!/^mailto:/.test(h[1])&&(h[1]="mailto:"+h[1]),u=t.selection.getBookmark(),t.selection.setRng(s),t.execCommand("createlink",!1,h[1]+h[2]),!1!==p&&t.dom.setAttrib(t.selection.getNode(),"target",p),t.selection.moveToBookmark(u),t.nodeChanged())}},d=function(t){var e;t.on("keydown",(function(e){if(13===e.keyCode)return function(t){s(t,-1,"")}(t)})),o.browser.isIE()?t.on("focus",(function(){if(!e){e=!0;try{t.execCommand("AutoUrlDetect",!1,!0)}catch(i){}}})):(t.on("keypress",(function(e){if(41===e.keyCode)return function(t){s(t,-1,"(")}(t)})),t.on("keyup",(function(e){if(32===e.keyCode)return function(t){s(t,0,"")}(t)})))};!function(){i.add("autolink",(function(t){d(t)}))}()}();